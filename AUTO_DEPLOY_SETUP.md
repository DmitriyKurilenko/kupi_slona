# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π Kupi Slona

–¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ.

---

## üìã –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç:

1. **Git pre-push hook** - –¥–µ–ø–ª–æ–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git push` (–ª–æ–∫–∞–ª—å–Ω–æ)
2. **GitHub Actions** - –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub CI/CD (–æ–±–ª–∞—á–Ω–æ)
3. **Git post-receive hook** - –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ bare repo (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ)

---

## ‚ö° –í–∞—Ä–∏–∞–Ω—Ç 1: Git Pre-Push Hook (–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º `git push` –ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è SSH –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

**1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd ~/kupi_slona

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è
chmod +x auto-deploy.sh
```

**2. –õ–æ–∫–∞–ª—å–Ω–æ:**

```bash
cd ~/Documents/dev/kupi_slona

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ hook
cp .git-hooks/pre-push .git/hooks/pre-push
chmod +x .git/hooks/pre-push

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nano .git/hooks/pre-push
```

–ò–∑–º–µ–Ω–∏—Ç–µ:
```bash
SERVER_USER="root"
SERVER_HOST="123.45.67.89"  # ‚Üê –í–∞—à IP —Å–µ—Ä–≤–µ—Ä–∞
SERVER_PATH="/root/kupi_slona"
```

**3. –ì–æ—Ç–æ–≤–æ!**

```bash
git add .
git commit -m "Update feature"
git push  # ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç!
```

---

## ü§ñ –í–∞—Ä–∏–∞–Ω—Ç 2: GitHub Actions (CI/CD)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–∏ `git push` –Ω–∞ GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ SSH.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

**1. –î–æ–±–∞–≤—å—Ç–µ SSH –∫–ª—é—á –Ω–∞ GitHub:**

–õ–æ–∫–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á (–µ—Å–ª–∏ –Ω–µ—Ç):
```bash
ssh-keygen -t ed25519 -C "github-deploy"
cat ~/.ssh/id_ed25519  # –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ü–†–ò–í–ê–¢–ù–´–ô –∫–ª—é—á
```

**2. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
nano ~/.ssh/authorized_keys
# –í—Å—Ç–∞–≤—å—Ç–µ –ü–£–ë–õ–ò–ß–ù–´–ô –∫–ª—é—á (id_ed25519.pub)
```

**3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets:**

GitHub ‚Üí –í–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions

–°–æ–∑–¥–∞–π—Ç–µ secrets:
- `SERVER_HOST` = `123.45.67.89` (IP —Å–µ—Ä–≤–µ—Ä–∞)
- `SERVER_USER` = `root`
- `SSH_PRIVATE_KEY` = *(—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ id_ed25519)*

**4. –ö–æ–º–º–∏—Ç—å—Ç–µ –∏ –ø—É—à—å—Ç–µ:**

```bash
git add .github/workflows/deploy.yml
git commit -m "Add auto-deploy workflow"
git push
```

**5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

GitHub ‚Üí Actions ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è workflow "Deploy to Production" ‚úÖ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è! üéâ

---

## üîß –í–∞—Ä–∏–∞–Ω—Ç 3: Git Post-Receive Hook (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç–µ bare git repo –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø—É—à–∏—Ç–µ —Ç—É–¥–∞ –Ω–∞–ø—Ä—è–º—É—é.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

**1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ bare repo:**

```bash
# –°–æ–∑–¥–∞–π—Ç–µ bare —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
mkdir -p ~/kupi_slona.git
cd ~/kupi_slona.git
git init --bare

# –°–æ–∑–¥–∞–π—Ç–µ post-receive hook
nano hooks/post-receive
```

–í—Å—Ç–∞–≤—å—Ç–µ:
```bash
#!/bin/bash
WORK_DIR="/root/kupi_slona"
cd $WORK_DIR
git pull origin main
cd $WORK_DIR
./auto-deploy.sh
```

–°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x hooks/post-receive
```

**2. –õ–æ–∫–∞–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ remote:**

```bash
cd ~/Documents/dev/kupi_slona

# –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–∞–∫ remote
git remote add production root@123.45.67.89:~/kupi_slona.git

# –ü—É—à—å—Ç–µ –Ω–∞ production
git push production main  # ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç!
```

**3. –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:**

```bash
git push production main
```

–î–ª—è GitHub + production:
```bash
git push origin main        # ‚Üí GitHub
git push production main    # ‚Üí –°–µ—Ä–≤–µ—Ä (–∞–≤—Ç–æ-–¥–µ–ø–ª–æ–π)
```

---

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç auto-deploy.sh?

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. ‚úÖ `git pull` - –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `.env` —Ñ–∞–π–ª
3. ‚úÖ –°–æ–∑–¥–∞—ë—Ç —Å–µ—Ç—å `nginx-proxy` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. ‚úÖ `docker-compose build` - –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
5. ‚úÖ `docker-compose up -d` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã
6. ‚úÖ `python manage.py migrate` - –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
7. ‚úÖ `python manage.py collectstatic` - —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏–∫—É
8. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –õ–æ–≥–∏ |
|---------|-----------|----------|--------------|------|
| **Pre-push hook** | üü¢ –õ–µ–≥–∫–æ | ‚ö° –ë—ã—Å—Ç—Ä–æ | –õ–æ–∫–∞–ª—å–Ω–æ | –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ |
| **GitHub Actions** | üü° –°—Ä–µ–¥–Ω–µ | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ | GitHub | –ù–∞ GitHub |
| **Post-receive** | üî¥ –°–ª–æ–∂–Ω–æ | ‚ö° –ë—ã—Å—Ç—Ä–æ | –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ | –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- **–†–∞–±–æ—Ç–∞–µ—Ç–µ –æ–¥–∏–Ω?** ‚Üí Pre-push hook
- **–ö–æ–º–∞–Ω–¥–∞ –Ω–∞ GitHub?** ‚Üí GitHub Actions
- **–ù—É–∂–Ω–∞ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å?** ‚Üí Post-receive hook

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: SSH –∫–ª—é—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@your-server-ip

# –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ ssh-agent
ssh-add ~/.ssh/id_ed25519
```

### –ü—Ä–æ–±–ª–µ–º–∞: auto-deploy.sh –ø–∞–¥–∞–µ—Ç

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
cd ~/kupi_slona
./auto-deploy.sh
# –°–º–æ—Ç—Ä–∏—Ç–µ –≥–¥–µ –æ—à–∏–±–∫–∞
```

### –ü—Ä–æ–±–ª–µ–º–∞: GitHub Actions –ø–∞–¥–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ GitHub ‚Üí Actions

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è:

```bash
# 1. –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
echo "# Test" >> README.md
git add README.md
git commit -m "Test auto-deploy"

# 2. –ó–∞–ø—É—à—å—Ç–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è!)
git push

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@your-server
docker-compose -f docker-compose.npm-simple.yml ps
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Up! ‚úÖ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git push` –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

**Workflow:**
```bash
git add .
git commit -m "New feature"
git push  # ‚Üê –ú–∞–≥–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–¥–µ—Å—å! ü™Ñ
```

**–ë–µ–∑ —Ä—É—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥! –ë–µ–∑ SSH! –ü—Ä–æ—Å—Ç–æ push! üöÄ**
